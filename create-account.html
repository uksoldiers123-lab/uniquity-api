
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Uniquity Solutions — Create Account</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=8">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- Navbar / Header (from index) -->
  <nav class="nav" aria-label="Primary">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <span class="brand-mark" aria-hidden="true"></span>
        Uniquity Solutions
      </a>
      <div class="nav-links">
        <a href="www.uniquitysolutions.com">Home</a>
        <a href="www.uniquitysolutions.com/services">Services</a>
        <a href="www.uniquitysolutions.com/partners">Partners</a>
        <a href="www.uniquitysolutions.com/careers">Careers</a>
        <div class="dropdown" data-dropdown>
          <button class="drop-toggle" type="button" data-toggle aria-haspopup="true" aria-expanded="false">
            Get Started
            <svg class="drop-caret" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="drop-menu" data-menu role="menu">
            <a href="https://buy.stripe.com/7sYeVcakW9dRbrObHsgw000" role="menuitem">Make a Payment</a>
            <a href="create-account.html" role="menuitem">Create Account (Merchants)</a>
            <a href="www.uniquitysolutions.com/faq.html" role="menuitem">FAQ</a>
            <a href="www.uniquitysolutions.com/pricing.html" role="menuitem">Pricing</a>
            <a href="www.uniquitysolutions.com/developers.html" role="menuitem">Developers & API</a>
            <a href="www.uniquitysolutions.com/integrations.html" role="menuitem">Integrations</a>
            <a href="www.uniquitysolutions.com/compliance.html" role="menuitem">Compliance & Security</a>
            <a href="login.html" role="menuitem">Login Portal</a>
          </div>
        </div>
        <a href="#contact" class="cta">Contact</a>
      </div>
      <button class="menu-btn" id="menuBtn" aria-expanded="false" aria-controls="mobileMenu">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile overlay menu (from index) -->
  <div id="mobileMenu" class="mobile-menu" role="dialog" aria-label="Mobile Navigation">
    <div class="menu-label">On this page</div>
    <a href="www.uniquitysolutions.com/www.uniquitysolutions.com/index.html">Home</a>
    <a href="www.uniquitysolutions.com/services">Services</a>
    <a href="www.uniquitysolutions.com/partners">Partners</a>
    <a href="www.uniquitysolutions.com/careers">Careers</a>
    <a href="www.uniquitysolutions.com/contact" class="cta">Contact</a>
    <div class="menu-label">More pages</div>
    <a href="https://buy.stripe.com/7sYeVcakW9dRbrObHsgw000">Make a Payment</a>
    <a href="create-account.html">Create Account (Merchants)</a>
    <a href="www.uniquitysolutions.com/faq.html">FAQ</a>
    <a href="www.uniquitysolutions.com/pricing.html">Pricing</a>
    <a href="www.uniquitysolutions.com/developers.html">Developers & API</a>
    <a href="www.uniquitysolutions.com/integrations.html">Integrations</a>
    <a href="www.uniquitysolutions.com/compliance.html">Compliance & Security</a>
    <a href="login.html">Login Portal</a>
  </div>
  
  <!-- ... keep your existing nav HTML here ... -->

  <main class="container" id="main" style="padding: 2rem 0;">
    <section aria-labelledby="signup-title" class="signup-section" style="max-width:960px; margin: 0 auto;">
      <h1 id="signup-title" style="text-align:center; margin-bottom: 1rem;">Create Account</h1>

      <form id="signup-form" style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
        <div style="grid-column: span 2;">
          <label>
            Full Name
            <input type="text" id="fullName" placeholder="Jane Doe" required />
          </label>
        </div>

        <div>
          <label>
            Email
            <input type="email" id="email" placeholder="you@example.com" required />
          </label>
        </div>

        <div>
          <label>
            Password
            <input type="password" id="password" placeholder="Create a password" required />
          </label>
        </div>

        <!-- Tenant/Client details -->
        <div>
          <label>
            Company / Tenant Name
            <input type="text" id="tenantName" placeholder="Acme LLC" required />
          </label>
        </div>

        <div>
          <label>
            Business Type
            <select id="businessType" required>
              <option value="">Select type</option>
              <option value="retail">Retail</option>
              <option value="saas">SaaS</option>
              <option value="service">Service</option>
              <option value="other">Other</option>
            </select>
          </label>
        </div>

        <div>
          <label>
            Website
            <input type="url" id="website" placeholder="https://example.com" />
          </label>
        </div>

        <div>
          <label>
            Phone
            <input type="tel" id="phone" placeholder="+1 555 000 0000" />
          </label>
        </div>

        <div>
          <label>
            Address Line 1
            <input type="text" id="address1" placeholder="123 Main St" />
          </label>
        </div>

        <div>
          <label>
            Address Line 2
            <input type="text" id="address2" placeholder="Apt 4B" />
          </label>
        </div>

        <div>
          <label>
            City
            <input type="text" id="city" placeholder="City" />
          </label>
        </div>

        <div>
          <label>
            State / Region
            <input type="text" id="state" placeholder="State" />
          </label>
        </div>

        <div>
          <label>
            Postal / ZIP
            <input type="text" id="postal" placeholder="ZIP" />
          </label>
        </div>

        <div>
          <label>
            Country
            <input type="text" id="country" placeholder="Country" />
          </label>
        </div>

        <div style="grid-column: 1 / span 2;">
          <label>
            I agree to the Terms and Privacy Policy
            <input type="checkbox" id="terms" required />
          </label>
        </div>

        <div style="grid-column: 1 / span 2; text-align:center;">
          <button type="submit" id="signup-btn" style="padding:.75rem 1.25rem; font-size:1rem;">
            Create Account
          </button>
        </div>

        <div id="signup-status" aria-live="polite" style="grid-column: 1 / span 2; color:#d00;"></div>
      </form>

      <hr style="margin: 1.5rem 0 0.5rem;" />

      <button id="github-signup" aria-label="Sign up with GitHub (admin)" style="padding:.75rem 1rem;">
        Sign up with GitHub (admin)
      </button>

      <p style="text-align:center; margin-top:.75rem; color:#666;">
        After sign-up, you’ll be redirected to your dashboard based on your role.
      </p>
    </section>
  </main>

  <script>
    // Replace with your actual environment values or import from a helper module
    const SUPABASE_URL = 'https://your-project.supabase.co';
    const SUPABASE_ANON_KEY = 'public-anon-key';
    const supabase = window.supabase || window.supabase = supabase || null;

    // Initialize if not already loaded
    (function initSupabase() {
      if (!supabase) {
        // If you have a module, import it instead
        const { createClient } = window?.Supabase || {};
        if (createClient) {
          window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } else {
          // Basic createClient fallback (requires global Supabase script)
          window.supabase = window.supabase || null;
        }
      }
    })();

    // Fallback robust role fetcher (adjust to your schema)
    async function getUserRole(userId) {
      // Example schemas; replace with your own
      let { data } = await window.supabase.from('tenant_users').select('role').eq('user_id', userId).maybeSingle();
      if (data?.role) return data.role;

      const { data: profile } = await window.supabase.from('profiles').select('role').eq('id', userId).maybeSingle();
      if (profile?.role) return profile.role;

      const { data: tenant } = await window.supabase.from('tenants').select('role').eq('id', userId).maybeSingle();
      if (tenant?.role) return tenant.role;

      return 'client';
    }

    function redirectByRole(role) {
      if (role === 'admin') {
        window.location.href = '/admin/dashboard';
      } else {
        window.location.href = '/dashboard';
      }
    }

    // Signup form handler
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('fullName')?.value || '';
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      // Optional: gather extra fields (sent to /api/signup if you have one)
      const tenantName = document.getElementById('tenantName').value.trim();
      const businessType = document.getElementById('businessType').value;
      const website = document.getElementById('website').value;
      const phone = document.getElementById('phone').value;
      const address1 = document.getElementById('address1').value;
      const address2 = document.getElementById('address2').value;
      const city = document.getElementById('city').value;
      const state = document.getElementById('state').value;
      const postal = document.getElementById('postal').value;
      const country = document.getElementById('country').value;
      const currency = document.getElementById('currency')?.value || 'USD';
      const timeZone = document.getElementById('timeZone')?.value || '';

      const termsAccepted = document.getElementById('terms').checked;
      const statusEl = document.getElementById('signup-status');
      statusEl.textContent = '';

      if (!termsAccepted) {
        statusEl.textContent = 'You must accept the terms to continue.';
        return;
      }

      if (!email || !password) {
        statusEl.textContent = 'Please provide email and password.';
        return;
      }

      // Show loading
      const signupBtn = document.getElementById('signup-btn');
      signupBtn.disabled = true;
      signupBtn.textContent = 'Creating account...';

      try {
        // Backend-friendly payload (send to your own /api/signup if you have one)
        const payload = {
          name,
          email,
          password,
          tenantName,
          businessType,
          website,
          phone,
          address1,
          address2,
          city,
          state,
          postal,
          country,
          currency,
          timeZone
        };

        // Try to call your backend signup API first
        const res = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok || data.error) {
          statusEl.textContent = data.error || 'Signup failed';
          signupBtn.disabled = false;
          signupBtn.textContent = 'Create Account';
          return;
        }

        // If backend returns a token, store it
        if (data.token) localStorage.setItem('authToken', data.token);

        // Determine role
        let role = data.role;
        const userId = data.userId || (data.user?.id);
        if (!role && userId) {
          role = await getUserRole(userId);
        }
        if (!role) role = 'client';

        redirectByRole(role);
      } catch (err) {
        statusEl.textContent = 'Network error. Please try again.';
      } finally {
        signupBtn.disabled = false;
        signupBtn.textContent = 'Create Account';
      }
    });

    // GitHub admin sign-up
    document.getElementById('github-signup').addEventListener('click', async () => {
      await supabase.auth.signInWithOAuth({ provider: 'github' });
      // After OAuth flow completes, handle redirect on callback page using role
    });
  </script>
</body>
</html>
